//TB3D 109993 Adapted from Meltac 2.0 DX11 shaders
#include "common.h"
#include "sload.h"

#ifdef DX11
f_deffer main(p_bumped I) {
f_deffer O;
surface_bumped S=sload(I);
float3 Ne=mul(float3x3(I.M1,I.M2,I.M3),S.normal);
Ne=normalize(Ne);
O.Ne=float4(Ne,S.base.w);
O.position=float4(I.position.xyz+Ne*S.height*def_virtualh,xmaterial);
O.C=float4(S.base.x,S.base.y,S.base.z,S.gloss);
return O;
}

#else

f_deffer main(p_bumped I) {
f_deffer O;
surface_bumped S=sload(I);
half3 Ne=mul(half3x3(I.M1,I.M2,I.M3),S.normal);
Ne=normalize(Ne);
O.Ne=half4(Ne,S.base.w);
O.position=half4(I.position.xyz+Ne*S.height*def_virtualh,xmaterial);
O.C=half4(S.base.x,S.base.y,S.base.z,S.gloss);
return O;
}

#endif