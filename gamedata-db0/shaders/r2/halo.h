//TB3D 109993 Adapted from Meltac 2.0 DX11 shaders
float2 _b__891(float2 f,float2 S,float N){float2 r=-S;float h=radians(N),z=sin(h),l=cos(h);float2x2 H=float2x2(l,-z,z,l);f=f+r;f=mul(f,H);f=f-r;return f;}float4 ___g0561(float2 f,float2 S,float N){float2 r=S;f=_b__891(f,S,S.x*SSH_STREAKSROTX+S.y*SSH_STREAKSROTY);float2 h=S-f,z=normalize(h)*N;float l=length(S-frac(f+z))/length(S);l=pow(1.-l,5.);float H=tex2Dlod(s_normal,float4(f+z,0,0)).w;return float4(H,H,H,1)*l;}float4 render_halo(float2 f,float2 S){float4 r;r=float4(0,0,0,0);float h=length(f-float2(.5,.5)),l=length(f-S);const float z=5*l*(.5f/1024.f);float4 H=(___g0561(f+z,S,SSH_STREAKSWIDTH)+___g0561(f-z,S,SSH_STREAKSWIDTH2))/2.f;float N=(r.x*.36+r.y*.63+r.z*.17)/3,X=(H.x*.36+H.y*.63+H.z*.17)/3;if(X-N>=SSH_STREAKSLUMDIFF){float s=l,x=saturate((s-SSH_STREAKSSUNNEARMIN)/(SSH_STREAKSSUNNEARMAX-SSH_STREAKSSUNNEARMIN)),y=1-saturate((s-SSH_STREAKSSUNDISTMIN)/(SSH_STREAKSSUNDISTMAX-SSH_STREAKSSUNDISTMIN));r.xyz+=SSH_STREAKS*x*y*H.xyz;r.xyz=lerp(r.xyz,r.xyz*L_sun_color,SSH_STREAKSSUNCOL);r.xyz*=1-saturate(pow(l,1));}if(r.w<1)r.w=1;return r;}