//TB3D 109993 Adapted from Meltac 2.0 DX11 shaders
#include "common.h"
#include "sload.h"

#ifdef DX11
struct p_particle {
p_flat base;
float4 color:COLOR0;
};
f_deffer main (p_particle II) {
f_deffer O;
p_flat I;I=II.base;
float4 D=tex2D(s_base,I.tcdh);
D*=II.color;
clip(D.w-def_aref);
O.Ne=float4(normalize((float3)I.N.xyz),I.position.w);
O.position=float4(I.position.xyz+O.Ne.xyz*def_virtualh/2.h,xmaterial);
O.C=float4(D.xyz,def_gloss);
return O;
}

#else

struct p_particle {
p_flat base;
half4 color:COLOR0;
};
f_deffer main (p_particle II) {
f_deffer O;
p_flat I;I=II.base;
half4 D=tex2D(s_base,I.tcdh);
D*=II.color;
clip(D.w-def_aref);
O.Ne=half4(normalize((half3)I.N.xyz),I.position.w);
O.position=half4(I.position.xyz+O.Ne.xyz*def_virtualh/2.h,xmaterial);
O.C=half4(D.xyz,def_gloss);
return O;
}

#endif